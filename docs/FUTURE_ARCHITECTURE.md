# ğŸ—ï¸ YumCha æœªæ¥æ¶æ„è§„åˆ’

ä¸º YumCha é¡¹ç›®è®¾è®¡çš„é•¿æœŸæ¶æ„è§„åˆ’ï¼Œæ”¯æŒå¤§å‹é¡¹ç›®å‘å±•å’Œæœªæ¥åŠŸèƒ½æ‰©å±•ã€‚

## ğŸ¯ æ¶æ„æ„¿æ™¯

### æ ¸å¿ƒç›®æ ‡
- ğŸ—ï¸ **æ¨¡å—åŒ–æ¶æ„**: æ”¯æŒåŠŸèƒ½æ¨¡å—çš„ç‹¬ç«‹å¼€å‘å’Œéƒ¨ç½²
- ğŸ”Œ **æ’ä»¶åŒ–ç³»ç»Ÿ**: æ”¯æŒç¬¬ä¸‰æ–¹æ’ä»¶å’Œæ‰©å±•
- ğŸŒ **å¤šå¹³å°æ”¯æŒ**: ç»Ÿä¸€ä»£ç åº“æ”¯æŒç§»åŠ¨ç«¯ã€æ¡Œé¢ç«¯ã€Web
- ğŸš€ **é«˜æ€§èƒ½**: ä¼˜åŒ–ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿæ€§èƒ½
- ğŸ”’ **å®‰å…¨å¯é **: ä¼ä¸šçº§å®‰å…¨å’Œæ•°æ®ä¿æŠ¤

### è®¾è®¡åŸåˆ™
- **å•ä¸€èŒè´£**: æ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªæ˜ç¡®çš„åŠŸèƒ½
- **å¼€æ”¾å°é—­**: å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­
- **ä¾èµ–å€’ç½®**: é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—
- **æ¥å£éš”ç¦»**: å®¢æˆ·ç«¯ä¸åº”ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£

## ğŸ›ï¸ ç›®æ ‡æ¶æ„

### æ•´ä½“æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        App Layer                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Mobile App    â”‚ â”‚   Desktop App   â”‚ â”‚     Web App     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Features Layer                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Chat   â”‚ â”‚   AI    â”‚ â”‚Settings â”‚ â”‚ Search  â”‚ â”‚ Plugins â”‚ â”‚
â”‚  â”‚ Module  â”‚ â”‚ Mgmt    â”‚ â”‚ Module  â”‚ â”‚ Module  â”‚ â”‚ System  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Shared Layer                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Domain Layer   â”‚ â”‚   Data Layer    â”‚ â”‚Infrastructure   â”‚ â”‚
â”‚  â”‚  (Business)     â”‚ â”‚   (Storage)     â”‚ â”‚   (Services)    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Core Layer                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Foundation    â”‚ â”‚    Platform     â”‚ â”‚   Extensions    â”‚ â”‚
â”‚  â”‚   (Utils/Base)  â”‚ â”‚   (Adapters)    â”‚ â”‚   (Helpers)     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¯¦ç»†ç›®å½•ç»“æ„
```
lib/
â”œâ”€â”€ app/                           # ğŸ¯ åº”ç”¨å±‚
â”‚   â”œâ”€â”€ mobile/                   # ç§»åŠ¨ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ desktop/                  # æ¡Œé¢ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ web/                      # Web åº”ç”¨
â”‚   â””â”€â”€ shared/                   # å…±äº«åº”ç”¨é€»è¾‘
â”‚       â”œâ”€â”€ navigation/           # å¯¼èˆªé…ç½®
â”‚       â”œâ”€â”€ theme/               # ä¸»é¢˜é…ç½®
â”‚       â”œâ”€â”€ config/              # åº”ç”¨é…ç½®
â”‚       â””â”€â”€ bootstrap/           # åº”ç”¨å¯åŠ¨
â”œâ”€â”€ features/                      # ğŸ¯ åŠŸèƒ½æ¨¡å—å±‚
â”‚   â”œâ”€â”€ chat/                     # åŸºç¡€èŠå¤©åŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ data/                # æ•°æ®å±‚
â”‚   â”‚   â”œâ”€â”€ domain/              # é¢†åŸŸå±‚
â”‚   â”‚   â”œâ”€â”€ presentation/        # è¡¨ç°å±‚
â”‚   â”‚   â””â”€â”€ chat_module.dart     # æ¨¡å—å¯¼å‡º
â”‚   â”œâ”€â”€ roleplay/                # ğŸ­ è§’è‰²æ‰®æ¼”æ¨¡å—ï¼ˆé…’é¦†å¯¹è¯ï¼‰
â”‚   â”‚   â”œâ”€â”€ data/                # è§’è‰²æ•°æ®ã€ä¸–ç•Œè®¾å®šæ•°æ®
â”‚   â”‚   â”œâ”€â”€ domain/              # è§’è‰²æ‰®æ¼”ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ presentation/        # è§’è‰²ç®¡ç†ã€ä¸–ç•Œè®¾å®šç•Œé¢
â”‚   â”‚   â””â”€â”€ roleplay_module.dart # æ¨¡å—å¯¼å‡º
â”‚   â”œâ”€â”€ world_info/              # ğŸŒ ä¸–ç•Œè®¾å®šæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ data/                # ä¸–ç•Œä¿¡æ¯æ•°æ®å±‚
â”‚   â”‚   â”œâ”€â”€ domain/              # ä¸–ç•Œä¿¡æ¯ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ presentation/        # ä¸–ç•Œä¿¡æ¯ç®¡ç†ç•Œé¢
â”‚   â”‚   â””â”€â”€ world_info_module.dart # æ¨¡å—å¯¼å‡º
â”‚   â”œâ”€â”€ character_management/    # ğŸ‘¤ è§’è‰²ç®¡ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ data/                # è§’è‰²æ•°æ®å±‚
â”‚   â”‚   â”œâ”€â”€ domain/              # è§’è‰²ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ presentation/        # è§’è‰²ç¼–è¾‘ç•Œé¢
â”‚   â”‚   â””â”€â”€ character_module.dart # æ¨¡å—å¯¼å‡º
â”‚   â”œâ”€â”€ ai_management/           # AI ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ settings/                # è®¾ç½®æ¨¡å—
â”‚   â”œâ”€â”€ search/                  # æœç´¢æ¨¡å—
â”‚   â”œâ”€â”€ analytics/               # åˆ†ææ¨¡å—
â”‚   â””â”€â”€ plugins/                 # æ’ä»¶ç³»ç»Ÿ
â”œâ”€â”€ shared/                       # ğŸ¯ å…±äº«å±‚
â”‚   â”œâ”€â”€ domain/                  # é¢†åŸŸå±‚
â”‚   â”‚   â”œâ”€â”€ entities/           # ä¸šåŠ¡å®ä½“
â”‚   â”‚   â”œâ”€â”€ repositories/       # ä»“åº“æ¥å£
â”‚   â”‚   â”œâ”€â”€ usecases/           # ç”¨ä¾‹
â”‚   â”‚   â””â”€â”€ value_objects/      # å€¼å¯¹è±¡
â”‚   â”œâ”€â”€ data/                    # æ•°æ®å±‚
â”‚   â”‚   â”œâ”€â”€ models/             # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ repositories/       # ä»“åº“å®ç°
â”‚   â”‚   â”œâ”€â”€ datasources/        # æ•°æ®æº
â”‚   â”‚   â””â”€â”€ database/           # æ•°æ®åº“
â”‚   â”œâ”€â”€ presentation/            # è¡¨ç°å±‚
â”‚   â”‚   â”œâ”€â”€ widgets/            # å…±äº«ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ providers/          # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ themes/             # ä¸»é¢˜
â”‚   â””â”€â”€ infrastructure/          # åŸºç¡€è®¾æ–½å±‚
â”‚       â”œâ”€â”€ services/           # æœåŠ¡å®ç°
â”‚       â”œâ”€â”€ network/            # ç½‘ç»œå±‚
â”‚       â”œâ”€â”€ storage/            # å­˜å‚¨å±‚
â”‚       â””â”€â”€ external/           # å¤–éƒ¨æœåŠ¡
â”œâ”€â”€ core/                         # ğŸ¯ æ ¸å¿ƒå±‚
â”‚   â”œâ”€â”€ foundation/              # åŸºç¡€è®¾æ–½
â”‚   â”‚   â”œâ”€â”€ constants/          # å¸¸é‡
â”‚   â”‚   â”œâ”€â”€ exceptions/         # å¼‚å¸¸
â”‚   â”‚   â”œâ”€â”€ types/              # ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ base/               # åŸºç±»
â”‚   â”œâ”€â”€ platform/               # å¹³å°é€‚é…
â”‚   â”‚   â”œâ”€â”€ mobile/             # ç§»åŠ¨ç«¯é€‚é…
â”‚   â”‚   â”œâ”€â”€ desktop/            # æ¡Œé¢ç«¯é€‚é…
â”‚   â”‚   â””â”€â”€ web/                # Web é€‚é…
â”‚   â””â”€â”€ extensions/             # æ‰©å±•æ–¹æ³•
â”‚       â”œâ”€â”€ dart/               # Dart æ‰©å±•
â”‚       â”œâ”€â”€ flutter/            # Flutter æ‰©å±•
â”‚       â””â”€â”€ third_party/        # ç¬¬ä¸‰æ–¹æ‰©å±•
â”œâ”€â”€ l10n/                        # ğŸŒ å›½é™…åŒ–
â”‚   â”œâ”€â”€ app_localizations.dart
â”‚   â”œâ”€â”€ app_en.arb
â”‚   â”œâ”€â”€ app_zh.arb
â”‚   â””â”€â”€ app_ja.arb
â””â”€â”€ plugins/                     # ğŸ”Œ æ’ä»¶ç³»ç»Ÿ
    â”œâ”€â”€ ai_providers/           # AI æä¾›å•†æ’ä»¶
    â”œâ”€â”€ storage/                # å­˜å‚¨æ’ä»¶
    â”œâ”€â”€ themes/                 # ä¸»é¢˜æ’ä»¶
    â””â”€â”€ integrations/           # é›†æˆæ’ä»¶
```

## ğŸ¯ åŠŸèƒ½æ¨¡å—è®¾è®¡

### ğŸ­ Roleplay æ¨¡å—ï¼ˆé…’é¦†å¯¹è¯æ ¸å¿ƒï¼‰
```
features/roleplay/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ character_card_model.dart      # è§’è‰²å¡ç‰‡æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ roleplay_session_model.dart    # è§’è‰²æ‰®æ¼”ä¼šè¯æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ character_persona_model.dart   # è§’è‰²äººæ ¼æ¨¡å‹
â”‚   â”‚   â””â”€â”€ roleplay_config_model.dart     # è§’è‰²æ‰®æ¼”é…ç½®
â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”œâ”€â”€ character_repository_impl.dart
â”‚   â”‚   â”œâ”€â”€ roleplay_repository_impl.dart
â”‚   â”‚   â””â”€â”€ persona_repository_impl.dart
â”‚   â””â”€â”€ datasources/
â”‚       â”œâ”€â”€ character_local_datasource.dart
â”‚       â”œâ”€â”€ character_remote_datasource.dart # æ”¯æŒä»URLå¯¼å…¥è§’è‰²
â”‚       â””â”€â”€ tavern_import_datasource.dart   # SillyTavernæ ¼å¼å¯¼å…¥
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”œâ”€â”€ character_card.dart            # è§’è‰²å¡ç‰‡å®ä½“
â”‚   â”‚   â”œâ”€â”€ character_persona.dart         # è§’è‰²äººæ ¼å®ä½“
â”‚   â”‚   â”œâ”€â”€ roleplay_session.dart          # è§’è‰²æ‰®æ¼”ä¼šè¯
â”‚   â”‚   â”œâ”€â”€ character_greeting.dart        # è§’è‰²é—®å€™è¯­
â”‚   â”‚   â””â”€â”€ character_example.dart         # è§’è‰²ç¤ºä¾‹å¯¹è¯
â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”œâ”€â”€ character_repository.dart
â”‚   â”‚   â”œâ”€â”€ roleplay_repository.dart
â”‚   â”‚   â””â”€â”€ persona_repository.dart
â”‚   â””â”€â”€ usecases/
â”‚       â”œâ”€â”€ create_character.dart
â”‚       â”œâ”€â”€ import_character_card.dart
â”‚       â”œâ”€â”€ start_roleplay_session.dart
â”‚       â”œâ”€â”€ switch_character_persona.dart
â”‚       â””â”€â”€ export_character_card.dart
â”œâ”€â”€ presentation/
â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â”œâ”€â”€ character_gallery_screen.dart  # è§’è‰²ç”»å»Š
â”‚   â”‚   â”œâ”€â”€ character_editor_screen.dart   # è§’è‰²ç¼–è¾‘å™¨
â”‚   â”‚   â”œâ”€â”€ roleplay_chat_screen.dart      # è§’è‰²æ‰®æ¼”èŠå¤©
â”‚   â”‚   â”œâ”€â”€ character_import_screen.dart   # è§’è‰²å¯¼å…¥
â”‚   â”‚   â””â”€â”€ persona_manager_screen.dart    # äººæ ¼ç®¡ç†
â”‚   â”œâ”€â”€ widgets/
â”‚   â”‚   â”œâ”€â”€ character_card_widget.dart     # è§’è‰²å¡ç‰‡ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ character_avatar_widget.dart   # è§’è‰²å¤´åƒç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ persona_selector_widget.dart   # äººæ ¼é€‰æ‹©å™¨
â”‚   â”‚   â”œâ”€â”€ greeting_selector_widget.dart  # é—®å€™è¯­é€‰æ‹©å™¨
â”‚   â”‚   â””â”€â”€ roleplay_message_bubble.dart   # è§’è‰²æ‰®æ¼”æ¶ˆæ¯æ°”æ³¡
â”‚   â”œâ”€â”€ providers/
â”‚   â”‚   â”œâ”€â”€ character_provider.dart
â”‚   â”‚   â”œâ”€â”€ roleplay_session_provider.dart
â”‚   â”‚   â”œâ”€â”€ persona_provider.dart
â”‚   â”‚   â””â”€â”€ character_import_provider.dart
â”‚   â””â”€â”€ controllers/
â”‚       â”œâ”€â”€ character_controller.dart
â”‚       â”œâ”€â”€ roleplay_controller.dart
â”‚       â””â”€â”€ persona_controller.dart
â””â”€â”€ roleplay_module.dart

### ğŸŒ World Info æ¨¡å—ï¼ˆä¸–ç•Œè®¾å®šç³»ç»Ÿï¼‰
```
features/world_info/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ world_info_entry_model.dart    # ä¸–ç•Œä¿¡æ¯æ¡ç›®
â”‚   â”‚   â”œâ”€â”€ world_info_book_model.dart     # ä¸–ç•Œä¿¡æ¯ä¹¦ç±
â”‚   â”‚   â”œâ”€â”€ lorebook_model.dart            # Lorebookæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ keyword_trigger_model.dart     # å…³é”®è¯è§¦å‘å™¨
â”‚   â”‚   â””â”€â”€ vector_embedding_model.dart    # å‘é‡åµŒå…¥æ¨¡å‹
â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”œâ”€â”€ world_info_repository_impl.dart
â”‚   â”‚   â”œâ”€â”€ lorebook_repository_impl.dart
â”‚   â”‚   â””â”€â”€ vector_store_repository_impl.dart
â”‚   â””â”€â”€ datasources/
â”‚       â”œâ”€â”€ world_info_local_datasource.dart
â”‚       â”œâ”€â”€ vector_embedding_datasource.dart
â”‚       â””â”€â”€ lorebook_import_datasource.dart
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”œâ”€â”€ world_info_entry.dart          # ä¸–ç•Œä¿¡æ¯æ¡ç›®å®ä½“
â”‚   â”‚   â”œâ”€â”€ world_info_book.dart           # ä¸–ç•Œä¿¡æ¯ä¹¦ç±å®ä½“
â”‚   â”‚   â”œâ”€â”€ keyword_trigger.dart           # å…³é”®è¯è§¦å‘å™¨
â”‚   â”‚   â”œâ”€â”€ activation_rule.dart           # æ¿€æ´»è§„åˆ™
â”‚   â”‚   â”œâ”€â”€ insertion_strategy.dart        # æ’å…¥ç­–ç•¥
â”‚   â”‚   â”œâ”€â”€ timed_effect.dart              # æ—¶é—´æ•ˆæœ
â”‚   â”‚   â””â”€â”€ vector_similarity.dart         # å‘é‡ç›¸ä¼¼åº¦
â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”œâ”€â”€ world_info_repository.dart
â”‚   â”‚   â”œâ”€â”€ lorebook_repository.dart
â”‚   â”‚   â””â”€â”€ vector_store_repository.dart
â”‚   â””â”€â”€ usecases/
â”‚       â”œâ”€â”€ create_world_info_entry.dart
â”‚       â”œâ”€â”€ activate_world_info.dart       # æ ¹æ®å…³é”®è¯æ¿€æ´»ä¸–ç•Œä¿¡æ¯
â”‚       â”œâ”€â”€ process_recursive_activation.dart # é€’å½’æ¿€æ´»å¤„ç†
â”‚       â”œâ”€â”€ manage_timed_effects.dart      # æ—¶é—´æ•ˆæœç®¡ç†
â”‚       â”œâ”€â”€ vector_similarity_search.dart # å‘é‡ç›¸ä¼¼åº¦æœç´¢
â”‚       â””â”€â”€ export_import_lorebook.dart
â”œâ”€â”€ presentation/
â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â”œâ”€â”€ world_info_manager_screen.dart # ä¸–ç•Œä¿¡æ¯ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ lorebook_editor_screen.dart    # Lorebookç¼–è¾‘å™¨
â”‚   â”‚   â”œâ”€â”€ world_info_entry_editor.dart   # æ¡ç›®ç¼–è¾‘å™¨
â”‚   â”‚   â”œâ”€â”€ keyword_manager_screen.dart    # å…³é”®è¯ç®¡ç†
â”‚   â”‚   â””â”€â”€ activation_debugger_screen.dart # æ¿€æ´»è°ƒè¯•å™¨
â”‚   â”œâ”€â”€ widgets/
â”‚   â”‚   â”œâ”€â”€ world_info_entry_widget.dart   # ä¸–ç•Œä¿¡æ¯æ¡ç›®ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ keyword_chip_widget.dart       # å…³é”®è¯æ ‡ç­¾ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ activation_indicator_widget.dart # æ¿€æ´»æŒ‡ç¤ºå™¨
â”‚   â”‚   â”œâ”€â”€ insertion_order_widget.dart    # æ’å…¥é¡ºåºç»„ä»¶
â”‚   â”‚   â””â”€â”€ timed_effect_widget.dart       # æ—¶é—´æ•ˆæœç»„ä»¶
â”‚   â”œâ”€â”€ providers/
â”‚   â”‚   â”œâ”€â”€ world_info_provider.dart
â”‚   â”‚   â”œâ”€â”€ lorebook_provider.dart
â”‚   â”‚   â”œâ”€â”€ activation_provider.dart
â”‚   â”‚   â””â”€â”€ vector_search_provider.dart
â”‚   â””â”€â”€ controllers/
â”‚       â”œâ”€â”€ world_info_controller.dart
â”‚       â”œâ”€â”€ activation_controller.dart
â”‚       â””â”€â”€ vector_controller.dart
â””â”€â”€ world_info_module.dart

### ğŸ’¬ Enhanced Chat æ¨¡å—ï¼ˆå¢å¼ºèŠå¤©ï¼‰
```
features/chat/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ enhanced_message_model.dart    # å¢å¼ºæ¶ˆæ¯æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ conversation_context_model.dart # å¯¹è¯ä¸Šä¸‹æ–‡
â”‚   â”‚   â”œâ”€â”€ prompt_template_model.dart     # æç¤ºæ¨¡æ¿
â”‚   â”‚   â””â”€â”€ chat_memory_model.dart         # èŠå¤©è®°å¿†
â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”œâ”€â”€ enhanced_chat_repository_impl.dart
â”‚   â”‚   â”œâ”€â”€ context_repository_impl.dart
â”‚   â”‚   â””â”€â”€ memory_repository_impl.dart
â”‚   â””â”€â”€ datasources/
â”‚       â”œâ”€â”€ chat_context_datasource.dart
â”‚       â”œâ”€â”€ prompt_template_datasource.dart
â”‚       â””â”€â”€ memory_datasource.dart
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”œâ”€â”€ enhanced_message.dart          # å¢å¼ºæ¶ˆæ¯å®ä½“
â”‚   â”‚   â”œâ”€â”€ conversation_context.dart      # å¯¹è¯ä¸Šä¸‹æ–‡
â”‚   â”‚   â”œâ”€â”€ prompt_injection.dart          # æç¤ºæ³¨å…¥
â”‚   â”‚   â”œâ”€â”€ chat_memory.dart               # èŠå¤©è®°å¿†
â”‚   â”‚   â””â”€â”€ context_window.dart            # ä¸Šä¸‹æ–‡çª—å£
â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”œâ”€â”€ enhanced_chat_repository.dart
â”‚   â”‚   â”œâ”€â”€ context_repository.dart
â”‚   â”‚   â””â”€â”€ memory_repository.dart
â”‚   â””â”€â”€ usecases/
â”‚       â”œâ”€â”€ build_enhanced_prompt.dart     # æ„å»ºå¢å¼ºæç¤º
â”‚       â”œâ”€â”€ inject_world_info.dart         # æ³¨å…¥ä¸–ç•Œä¿¡æ¯
â”‚       â”œâ”€â”€ manage_context_window.dart     # ç®¡ç†ä¸Šä¸‹æ–‡çª—å£
â”‚       â”œâ”€â”€ process_character_memory.dart  # å¤„ç†è§’è‰²è®°å¿†
â”‚       â””â”€â”€ handle_prompt_templates.dart   # å¤„ç†æç¤ºæ¨¡æ¿
â”œâ”€â”€ presentation/
â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â”œâ”€â”€ enhanced_chat_screen.dart      # å¢å¼ºèŠå¤©ç•Œé¢
â”‚   â”‚   â”œâ”€â”€ context_debugger_screen.dart   # ä¸Šä¸‹æ–‡è°ƒè¯•å™¨
â”‚   â”‚   â”œâ”€â”€ prompt_builder_screen.dart     # æç¤ºæ„å»ºå™¨
â”‚   â”‚   â””â”€â”€ memory_viewer_screen.dart      # è®°å¿†æŸ¥çœ‹å™¨
â”‚   â”œâ”€â”€ widgets/
â”‚   â”‚   â”œâ”€â”€ enhanced_message_bubble.dart   # å¢å¼ºæ¶ˆæ¯æ°”æ³¡
â”‚   â”‚   â”œâ”€â”€ context_indicator_widget.dart  # ä¸Šä¸‹æ–‡æŒ‡ç¤ºå™¨
â”‚   â”‚   â”œâ”€â”€ world_info_injection_widget.dart # ä¸–ç•Œä¿¡æ¯æ³¨å…¥ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ memory_summary_widget.dart     # è®°å¿†æ‘˜è¦ç»„ä»¶
â”‚   â”‚   â””â”€â”€ prompt_preview_widget.dart     # æç¤ºé¢„è§ˆç»„ä»¶
â”‚   â”œâ”€â”€ providers/
â”‚   â”‚   â”œâ”€â”€ enhanced_chat_provider.dart
â”‚   â”‚   â”œâ”€â”€ context_provider.dart
â”‚   â”‚   â”œâ”€â”€ prompt_provider.dart
â”‚   â”‚   â””â”€â”€ memory_provider.dart
â”‚   â””â”€â”€ controllers/
â”‚       â”œâ”€â”€ enhanced_chat_controller.dart
â”‚       â”œâ”€â”€ context_controller.dart
â”‚       â””â”€â”€ prompt_controller.dart
â””â”€â”€ enhanced_chat_module.dart
```

## ğŸ­ é…’é¦†å¯¹è¯æ ¸å¿ƒæ¶æ„

### è§’è‰²å¡ç‰‡ç³»ç»Ÿ
```dart
// shared/domain/entities/character_card.dart
class CharacterCard {
  final String id;
  final String name;
  final String description;
  final String personality;
  final String scenario;
  final String firstMessage;
  final List<String> alternativeGreetings;
  final List<ExampleMessage> exampleMessages;
  final Map<String, dynamic> advancedDefinitions;
  final String? avatarUrl;
  final Map<String, String> metadata; // creator, version, etc.
  final List<String> tags;

  // SillyTavern å…¼å®¹å­—æ®µ
  final String? creatorNotes;
  final String? characterNote;
  final int? talkativeness; // 0-100, for group chats
  final Map<String, dynamic>? extensions; // æ‰©å±•æ•°æ®
}

// è§’è‰²ç¤ºä¾‹å¯¹è¯
class ExampleMessage {
  final String speaker; // {{char}} or {{user}}
  final String content;
  final MessageRole role; // system, user, assistant
}
```

### ä¸–ç•Œä¿¡æ¯ç³»ç»Ÿ
```dart
// shared/domain/entities/world_info_entry.dart
class WorldInfoEntry {
  final String id;
  final String title;
  final String content;
  final List<String> keys; // è§¦å‘å…³é”®è¯
  final List<String>? secondaryKeys; // å¯é€‰è¿‡æ»¤å™¨
  final SecondaryKeyLogic? secondaryLogic; // AND_ANY, AND_ALL, NOT_ANY, NOT_ALL
  final bool isConstant; // è“åœˆï¼šæ€»æ˜¯æ¿€æ´»
  final bool isEnabled; // ç»¿åœˆï¼šå…³é”®è¯æ¿€æ´»
  final bool allowVectorActivation; // é“¾æ¥ï¼šå‘é‡æ¿€æ´»
  final int insertionOrder; // æ’å…¥é¡ºåº
  final InsertionPosition insertionPosition;
  final int triggerPercentage; // è§¦å‘æ¦‚ç‡ 0-100
  final String? inclusionGroup; // åŒ…å«ç»„
  final int groupWeight; // ç»„æƒé‡
  final bool prioritizeInclusion; // ä¼˜å…ˆåŒ…å«
  final bool useGroupScoring; // ä½¿ç”¨ç»„è¯„åˆ†
  final String? automationId; // è‡ªåŠ¨åŒ–ID
  final TimedEffects? timedEffects; // æ—¶é—´æ•ˆæœ
  final bool caseSensitive; // å¤§å°å†™æ•æ„Ÿ
  final bool matchWholeWords; // åŒ¹é…æ•´è¯
  final Set<MatchingSource> additionalSources; // é¢å¤–åŒ¹é…æº
}

// æ—¶é—´æ•ˆæœ
class TimedEffects {
  final int sticky; // ç²˜æ€§æŒç»­æ¶ˆæ¯æ•°
  final int cooldown; // å†·å´æ¶ˆæ¯æ•°
  final int delay; // å»¶è¿Ÿæ¶ˆæ¯æ•°
}

// æ’å…¥ä½ç½®
enum InsertionPosition {
  beforeCharDefs,
  afterCharDefs,
  beforeExampleMessages,
  afterExampleMessages,
  topOfAuthorNote,
  bottomOfAuthorNote,
  atDepth, // @ D: ç‰¹å®šæ·±åº¦
}

// åŒ¹é…æº
enum MatchingSource {
  characterDescription,
  characterPersonality,
  scenario,
  personaDescription,
  characterNote,
  creatorNotes,
}
```

### ä¸–ç•Œä¿¡æ¯æ¿€æ´»å¼•æ“
```dart
// features/world_info/domain/usecases/activate_world_info.dart
class ActivateWorldInfoUseCase {
  Future<List<ActivatedEntry>> activateEntries({
    required List<WorldInfoEntry> entries,
    required String scanText,
    required int scanDepth,
    required int maxTokens,
    required bool includeNames,
    required CharacterCard? character,
    required String? persona,
  }) async {
    final activatedEntries = <ActivatedEntry>[];

    // 1. å¤„ç†å¸¸é‡æ¡ç›®ï¼ˆè“åœˆï¼‰
    final constantEntries = entries.where((e) => e.isConstant).toList();
    activatedEntries.addAll(constantEntries.map((e) => ActivatedEntry(e, ActivationType.constant)));

    // 2. å…³é”®è¯åŒ¹é…æ¿€æ´»
    final keywordActivated = await _processKeywordActivation(entries, scanText);
    activatedEntries.addAll(keywordActivated);

    // 3. å‘é‡ç›¸ä¼¼åº¦æ¿€æ´»
    final vectorActivated = await _processVectorActivation(entries, scanText);
    activatedEntries.addAll(vectorActivated);

    // 4. é€’å½’æ¿€æ´»å¤„ç†
    final recursiveActivated = await _processRecursiveActivation(activatedEntries, entries);
    activatedEntries.addAll(recursiveActivated);

    // 5. åº”ç”¨æ—¶é—´æ•ˆæœ
    final timedFiltered = await _applyTimedEffects(activatedEntries);

    // 6. åº”ç”¨åŒ…å«ç»„è§„åˆ™
    final groupFiltered = await _applyInclusionGroups(timedFiltered);

    // 7. åº”ç”¨è§¦å‘æ¦‚ç‡
    final probabilityFiltered = await _applyTriggerProbability(groupFiltered);

    // 8. æŒ‰æ’å…¥é¡ºåºæ’åºå¹¶åº”ç”¨tokené¢„ç®—
    return _applyTokenBudget(probabilityFiltered, maxTokens);
  }
}
```

### æç¤ºæ„å»ºå¼•æ“
```dart
// features/chat/domain/usecases/build_enhanced_prompt.dart
class BuildEnhancedPromptUseCase {
  Future<EnhancedPrompt> buildPrompt({
    required CharacterCard character,
    required List<Message> chatHistory,
    required List<ActivatedEntry> worldInfoEntries,
    required String? authorNote,
    required PromptTemplate template,
  }) async {
    final promptBuilder = PromptBuilder(template);

    // 1. æ„å»ºç³»ç»Ÿæç¤º
    final systemPrompt = await _buildSystemPrompt(character);
    promptBuilder.setSystemPrompt(systemPrompt);

    // 2. æ³¨å…¥è§’è‰²å®šä¹‰
    await _injectCharacterDefinitions(promptBuilder, character);

    // 3. æ³¨å…¥ä¸–ç•Œä¿¡æ¯ï¼ˆæŒ‰æ’å…¥ä½ç½®ï¼‰
    await _injectWorldInfo(promptBuilder, worldInfoEntries);

    // 4. æ³¨å…¥ç¤ºä¾‹å¯¹è¯
    await _injectExampleMessages(promptBuilder, character.exampleMessages);

    // 5. æ³¨å…¥ä½œè€…æ³¨é‡Š
    if (authorNote != null) {
      await _injectAuthorNote(promptBuilder, authorNote);
    }

    // 6. æ³¨å…¥èŠå¤©å†å²
    await _injectChatHistory(promptBuilder, chatHistory);

    // 7. åº”ç”¨ä¸Šä¸‹æ–‡çª—å£é™åˆ¶
    return await _applyContextWindow(promptBuilder);
  }
}
```

## ğŸ”Œ æ’ä»¶ç³»ç»Ÿè®¾è®¡

### é…’é¦†å¯¹è¯æ’ä»¶æ¥å£
```dart
// core/foundation/base/plugin_base.dart
abstract class PluginBase {
  String get id;
  String get name;
  String get version;
  List<String> get dependencies;

  Future<void> initialize();
  Future<void> dispose();
}

// è§’è‰²å¡ç‰‡æ’ä»¶æ¥å£
abstract class CharacterCardPlugin extends PluginBase {
  Future<CharacterCard?> importFromUrl(String url);
  Future<CharacterCard?> importFromFile(String filePath);
  Future<void> exportToFile(CharacterCard character, String filePath);
  bool supportsFormat(String format); // v1, v2, tavern, etc.
}

// ä¸–ç•Œä¿¡æ¯æ’ä»¶æ¥å£
abstract class WorldInfoPlugin extends PluginBase {
  Future<List<WorldInfoEntry>> importLorebook(String filePath);
  Future<void> exportLorebook(List<WorldInfoEntry> entries, String filePath);
  Future<List<ActivatedEntry>> processCustomActivation(
    List<WorldInfoEntry> entries,
    String context,
  );
}

// å‘é‡å­˜å‚¨æ’ä»¶æ¥å£
abstract class VectorStoragePlugin extends PluginBase {
  Future<void> indexEntry(String id, String content);
  Future<List<SimilarityMatch>> searchSimilar(String query, int maxResults);
  Future<void> deleteIndex(String id);
}
```

### æ’ä»¶æ³¨å†Œç³»ç»Ÿ
```dart
// plugins/plugin_registry.dart
class PluginRegistry {
  static final Map<Type, List<PluginBase>> _plugins = {};

  static void register<T extends PluginBase>(T plugin) {
    _plugins.putIfAbsent(T, () => []).add(plugin);
  }

  static List<T> getPlugins<T extends PluginBase>() {
    return _plugins[T]?.cast<T>() ?? [];
  }

  // é…’é¦†å¯¹è¯ç‰¹å®šæ³¨å†Œ
  static void registerTavernPlugins() {
    register(SillyTavernImportPlugin());
    register(CharacterHubPlugin());
    register(OpenAIEmbeddingPlugin());
    register(LocalVectorStorePlugin());
  }
}
```

## ğŸŒ å¤šå¹³å°æ”¯æŒ

### å¹³å°é€‚é…å±‚
```dart
// core/platform/platform_adapter.dart
abstract class PlatformAdapter {
  bool get isMobile;
  bool get isDesktop;
  bool get isWeb;
  
  Future<void> initializePlatform();
  Widget buildPlatformSpecificWidget(Widget child);
}

// ç§»åŠ¨ç«¯é€‚é…
class MobilePlatformAdapter extends PlatformAdapter {
  @override
  bool get isMobile => true;
  
  @override
  Widget buildPlatformSpecificWidget(Widget child) {
    return SafeArea(child: child);
  }
}

// æ¡Œé¢ç«¯é€‚é…
class DesktopPlatformAdapter extends PlatformAdapter {
  @override
  bool get isDesktop => true;
  
  @override
  Widget buildPlatformSpecificWidget(Widget child) {
    return Container(
      constraints: BoxConstraints(maxWidth: 1200),
      child: child,
    );
  }
}
```

## ğŸ”„ çŠ¶æ€ç®¡ç†æ¶æ„

### ç»Ÿä¸€çŠ¶æ€ç®¡ç†
```dart
// shared/presentation/providers/app_state.dart
class AppState {
  final UserState user;
  final ChatState chat;
  final SettingsState settings;
  final ThemeState theme;
  
  AppState({
    required this.user,
    required this.chat,
    required this.settings,
    required this.theme,
  });
}

// åŠŸèƒ½æ¨¡å—çŠ¶æ€
class ChatState {
  final List<Conversation> conversations;
  final Conversation? currentConversation;
  final bool isLoading;
  final String? error;
  
  ChatState({
    required this.conversations,
    this.currentConversation,
    this.isLoading = false,
    this.error,
  });
}
```

## ğŸ“Š æ•°æ®æµæ¶æ„

### æ•°æ®æµå›¾
```mermaid
graph TD
    A[UI Layer] --> B[Presentation Layer]
    B --> C[Domain Layer]
    C --> D[Data Layer]
    D --> E[External APIs]
    
    B --> F[State Management]
    F --> A
    
    C --> G[Business Logic]
    G --> C
    
    D --> H[Local Storage]
    D --> I[Remote APIs]
    D --> J[Cache Layer]
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½
```dart
// åŠŸèƒ½æ¨¡å—æ‡’åŠ è½½
class FeatureLoader {
  static Future<Widget> loadChatModule() async {
    await ChatModule.initialize();
    return ChatScreen();
  }
  
  static Future<Widget> loadSettingsModule() async {
    await SettingsModule.initialize();
    return SettingsScreen();
  }
}
```

### 2. ç¼“å­˜ç­–ç•¥
```dart
// å¤šå±‚ç¼“å­˜ç³»ç»Ÿ
class CacheManager {
  final MemoryCache memoryCache;
  final DiskCache diskCache;
  final NetworkCache networkCache;
  
  Future<T?> get<T>(String key) async {
    // 1. å†…å­˜ç¼“å­˜
    var result = await memoryCache.get<T>(key);
    if (result != null) return result;
    
    // 2. ç£ç›˜ç¼“å­˜
    result = await diskCache.get<T>(key);
    if (result != null) {
      await memoryCache.set(key, result);
      return result;
    }
    
    // 3. ç½‘ç»œç¼“å­˜
    result = await networkCache.get<T>(key);
    if (result != null) {
      await diskCache.set(key, result);
      await memoryCache.set(key, result);
    }
    
    return result;
  }
}
```

## ğŸ”’ å®‰å…¨æ¶æ„

### æ•°æ®åŠ å¯†
```dart
// core/foundation/security/encryption.dart
class EncryptionService {
  Future<String> encrypt(String data);
  Future<String> decrypt(String encryptedData);
  Future<void> rotateKeys();
}
```

### æƒé™ç®¡ç†
```dart
// shared/domain/entities/permission.dart
enum Permission {
  readMessages,
  writeMessages,
  manageSettings,
  accessDebugTools,
}

class PermissionManager {
  bool hasPermission(Permission permission);
  Future<void> requestPermission(Permission permission);
}
```

## ğŸ­ é…’é¦†å¯¹è¯åŠŸèƒ½å®æ–½è·¯çº¿å›¾

### é˜¶æ®µä¸€ï¼šåŸºç¡€è§’è‰²ç³»ç»Ÿï¼ˆ3-4å‘¨ï¼‰

#### 1.1 è§’è‰²å¡ç‰‡æ ¸å¿ƒåŠŸèƒ½
- [ ] **è§’è‰²å¡ç‰‡æ•°æ®æ¨¡å‹**ï¼šæ”¯æŒ SillyTavern v1/v2 æ ¼å¼
- [ ] **è§’è‰²åˆ›å»ºå’Œç¼–è¾‘**ï¼šå®Œæ•´çš„è§’è‰²ç¼–è¾‘å™¨ç•Œé¢
- [ ] **è§’è‰²å¯¼å…¥å¯¼å‡º**ï¼šæ”¯æŒ .json, .png (embedded), .webp æ ¼å¼
- [ ] **è§’è‰²ç”»å»Š**ï¼šè§’è‰²åˆ—è¡¨ã€æœç´¢ã€åˆ†ç±»ã€æ”¶è—
- [ ] **å¤šé—®å€™è¯­æ”¯æŒ**ï¼šå¯é€‰æ‹©ä¸åŒçš„å¼€åœºç™½

#### 1.2 åŸºç¡€è§’è‰²æ‰®æ¼”èŠå¤©
- [ ] **è§’è‰²æ‰®æ¼”èŠå¤©ç•Œé¢**ï¼šä¸“é—¨çš„è§’è‰²æ‰®æ¼”èŠå¤©UI
- [ ] **è§’è‰²äººæ ¼æ³¨å…¥**ï¼šå°†è§’è‰²ä¿¡æ¯æ³¨å…¥åˆ°æç¤ºä¸­
- [ ] **ç¤ºä¾‹å¯¹è¯å¤„ç†**ï¼šæ”¯æŒè§’è‰²ç¤ºä¾‹å¯¹è¯æ ¼å¼
- [ ] **è§’è‰²è®°å¿†ç®¡ç†**ï¼šåŸºç¡€çš„è§’è‰²è®°å¿†åŠŸèƒ½

### é˜¶æ®µäºŒï¼šä¸–ç•Œä¿¡æ¯ç³»ç»Ÿï¼ˆ4-5å‘¨ï¼‰

#### 2.1 ä¸–ç•Œä¿¡æ¯æ ¸å¿ƒå¼•æ“
- [ ] **ä¸–ç•Œä¿¡æ¯æ¡ç›®ç®¡ç†**ï¼šåˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ä¸–ç•Œä¿¡æ¯
- [ ] **å…³é”®è¯è§¦å‘ç³»ç»Ÿ**ï¼šåŸºç¡€å…³é”®è¯åŒ¹é…å’Œæ¿€æ´»
- [ ] **æ’å…¥ä½ç½®æ§åˆ¶**ï¼šæ”¯æŒä¸åŒçš„æ’å…¥ä½ç½®ç­–ç•¥
- [ ] **é€’å½’æ¿€æ´»**ï¼šä¸–ç•Œä¿¡æ¯æ¡ç›®é—´çš„é€’å½’è§¦å‘
- [ ] **æ¿€æ´»è°ƒè¯•å™¨**ï¼šå¯è§†åŒ–ä¸–ç•Œä¿¡æ¯æ¿€æ´»è¿‡ç¨‹

#### 2.2 é«˜çº§æ¿€æ´»è§„åˆ™
- [ ] **å¯é€‰è¿‡æ»¤å™¨**ï¼šAND ANY, AND ALL, NOT ANY, NOT ALL é€»è¾‘
- [ ] **è§¦å‘æ¦‚ç‡**ï¼šéšæœºäº‹ä»¶æ”¯æŒ
- [ ] **åŒ…å«ç»„**ï¼šäº’æ–¥ç»„å’Œæƒé‡é€‰æ‹©
- [ ] **æ—¶é—´æ•ˆæœ**ï¼šSticky, Cooldown, Delay æ•ˆæœ
- [ ] **å¤§å°å†™æ•æ„Ÿ**ï¼šå¯é…ç½®çš„åŒ¹é…è§„åˆ™

#### 2.3 å‘é‡å­˜å‚¨é›†æˆ
- [ ] **å‘é‡åµŒå…¥æœåŠ¡**ï¼šé›†æˆ OpenAI Embeddings æˆ–æœ¬åœ°æ¨¡å‹
- [ ] **ç›¸ä¼¼åº¦æœç´¢**ï¼šåŸºäºè¯­ä¹‰ç›¸ä¼¼åº¦çš„ä¸–ç•Œä¿¡æ¯æ¿€æ´»
- [ ] **å‘é‡ç´¢å¼•ç®¡ç†**ï¼šè‡ªåŠ¨ç´¢å¼•å’Œæ›´æ–°ä¸–ç•Œä¿¡æ¯
- [ ] **æ··åˆæ¿€æ´»**ï¼šå…³é”®è¯ + å‘é‡çš„æ··åˆæ¿€æ´»ç­–ç•¥

### é˜¶æ®µä¸‰ï¼šé«˜çº§æç¤ºç®¡ç†ï¼ˆ3-4å‘¨ï¼‰

#### 3.1 æç¤ºæ„å»ºå¼•æ“
- [ ] **åŠ¨æ€æç¤ºæ„å»º**ï¼šæ ¹æ®è§’è‰²å’Œä¸–ç•Œä¿¡æ¯åŠ¨æ€æ„å»ºæç¤º
- [ ] **ä¸Šä¸‹æ–‡çª—å£ç®¡ç†**ï¼šæ™ºèƒ½çš„ä¸Šä¸‹æ–‡é•¿åº¦æ§åˆ¶
- [ ] **æç¤ºæ¨¡æ¿ç³»ç»Ÿ**ï¼šå¯è‡ªå®šä¹‰çš„æç¤ºæ¨¡æ¿
- [ ] **ä½œè€…æ³¨é‡Šæ”¯æŒ**ï¼šAuthor's Note åŠŸèƒ½
- [ ] **æç¤ºé¢„è§ˆå™¨**ï¼šå®æ—¶é¢„è§ˆæœ€ç»ˆå‘é€çš„æç¤º

#### 3.2 é«˜çº§èŠå¤©åŠŸèƒ½
- [ ] **ç¾¤ç»„èŠå¤©æ”¯æŒ**ï¼šå¤šè§’è‰²ç¾¤ç»„å¯¹è¯
- [ ] **è§’è‰²åˆ‡æ¢**ï¼šåœ¨å¯¹è¯ä¸­åˆ‡æ¢ä¸åŒè§’è‰²
- [ ] **åˆ†æ”¯å¯¹è¯**ï¼šæ”¯æŒå¯¹è¯åˆ†æ”¯å’Œå›æ»š
- [ ] **èŠå¤©å¯¼å‡ºå¯¼å…¥**ï¼šå®Œæ•´çš„èŠå¤©è®°å½•ç®¡ç†

### é˜¶æ®µå››ï¼šç”Ÿæ€ç³»ç»Ÿé›†æˆï¼ˆ2-3å‘¨ï¼‰

#### 4.1 å¤–éƒ¨èµ„æºé›†æˆ
- [ ] **CharacterHub é›†æˆ**ï¼šä» CharacterHub å¯¼å…¥è§’è‰²
- [ ] **ç¤¾åŒºèµ„æºæ”¯æŒ**ï¼šæ”¯æŒç¤¾åŒºè§’è‰²å’Œä¸–ç•Œä¿¡æ¯åˆ†äº«
- [ ] **äº‘åŒæ­¥**ï¼šè§’è‰²å’Œä¸–ç•Œä¿¡æ¯çš„äº‘ç«¯åŒæ­¥
- [ ] **å¤‡ä»½æ¢å¤**ï¼šå®Œæ•´çš„æ•°æ®å¤‡ä»½å’Œæ¢å¤

#### 4.2 æ’ä»¶ç”Ÿæ€
- [ ] **è§’è‰²å¡ç‰‡æ’ä»¶**ï¼šæ”¯æŒç¬¬ä¸‰æ–¹è§’è‰²æ ¼å¼
- [ ] **ä¸–ç•Œä¿¡æ¯æ’ä»¶**ï¼šè‡ªå®šä¹‰æ¿€æ´»é€»è¾‘
- [ ] **ä¸»é¢˜æ’ä»¶**ï¼šè§’è‰²æ‰®æ¼”ä¸“ç”¨ä¸»é¢˜
- [ ] **å·¥å…·é›†æˆ**ï¼šä¸å¤–éƒ¨å·¥å…·çš„é›†æˆ

## ğŸ¯ é…’é¦†å¯¹è¯åŠŸèƒ½ç‰¹æ€§å¯¹æ¯”

| åŠŸèƒ½ç‰¹æ€§ | SillyTavern | YumCha ç›®æ ‡ | å®æ–½ä¼˜å…ˆçº§ |
|---------|-------------|-------------|-----------|
| **è§’è‰²ç®¡ç†** |
| è§’è‰²å¡ç‰‡ v1/v2 | âœ… | ğŸ¯ é˜¶æ®µä¸€ | é«˜ |
| è§’è‰²å¯¼å…¥å¯¼å‡º | âœ… | ğŸ¯ é˜¶æ®µä¸€ | é«˜ |
| å¤šé—®å€™è¯­ | âœ… | ğŸ¯ é˜¶æ®µä¸€ | ä¸­ |
| è§’è‰²åˆ†ç»„æ ‡ç­¾ | âœ… | ğŸ¯ é˜¶æ®µä¸€ | ä¸­ |
| **ä¸–ç•Œä¿¡æ¯** |
| å…³é”®è¯æ¿€æ´» | âœ… | ğŸ¯ é˜¶æ®µäºŒ | é«˜ |
| é€’å½’æ¿€æ´» | âœ… | ğŸ¯ é˜¶æ®µäºŒ | é«˜ |
| å‘é‡æ¿€æ´» | âœ… | ğŸ¯ é˜¶æ®µäºŒ | ä¸­ |
| æ—¶é—´æ•ˆæœ | âœ… | ğŸ¯ é˜¶æ®µäºŒ | ä½ |
| åŒ…å«ç»„ | âœ… | ğŸ¯ é˜¶æ®µäºŒ | ä¸­ |
| **èŠå¤©åŠŸèƒ½** |
| ç¾¤ç»„èŠå¤© | âœ… | ğŸ¯ é˜¶æ®µä¸‰ | ä¸­ |
| åˆ†æ”¯å¯¹è¯ | âœ… | ğŸ¯ é˜¶æ®µä¸‰ | ä½ |
| ä½œè€…æ³¨é‡Š | âœ… | ğŸ¯ é˜¶æ®µä¸‰ | ä¸­ |
| æç¤ºé¢„è§ˆ | âœ… | ğŸ¯ é˜¶æ®µä¸‰ | é«˜ |
| **ç”Ÿæ€é›†æˆ** |
| CharacterHub | âœ… | ğŸ¯ é˜¶æ®µå›› | ä½ |
| äº‘åŒæ­¥ | âŒ | ğŸ¯ é˜¶æ®µå›› | ä¸­ |
| ç§»åŠ¨ç«¯ä¼˜åŒ– | âŒ | âœ… åŸç”Ÿæ”¯æŒ | é«˜ |
| å¤šè¯­è¨€æ”¯æŒ | éƒ¨åˆ† | âœ… å®Œæ•´æ”¯æŒ | ä¸­ |

## ğŸ”§ æŠ€æœ¯å®ç°è¦ç‚¹

### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
```dart
// ä¸–ç•Œä¿¡æ¯æ¿€æ´»ä¼˜åŒ–
class WorldInfoOptimizer {
  // 1. å…³é”®è¯ç´¢å¼•ä¼˜åŒ–
  final Map<String, Set<String>> _keywordIndex = {};

  // 2. å‘é‡ç¼“å­˜
  final LRUCache<String, List<double>> _embeddingCache = LRUCache(1000);

  // 3. æ¿€æ´»ç»“æœç¼“å­˜
  final Map<String, List<ActivatedEntry>> _activationCache = {};

  // 4. å¼‚æ­¥æ¿€æ´»å¤„ç†
  Future<List<ActivatedEntry>> optimizedActivation(String context) async {
    // ä½¿ç”¨ç´¢å¼•å¿«é€Ÿç­›é€‰å€™é€‰æ¡ç›®
    final candidates = await _getCandidateEntries(context);

    // å¹¶è¡Œå¤„ç†å‘é‡æœç´¢å’Œå…³é”®è¯åŒ¹é…
    final results = await Future.wait([
      _processKeywordMatching(candidates, context),
      _processVectorMatching(candidates, context),
    ]);

    return _mergeResults(results);
  }
}
```

### æ•°æ®å­˜å‚¨ç­–ç•¥
```dart
// åˆ†å±‚å­˜å‚¨æ¶æ„
class TavernDataStorage {
  // 1. è§’è‰²å¡ç‰‡å­˜å‚¨ï¼ˆSQLite + æ–‡ä»¶ï¼‰
  final CharacterStorage characterStorage;

  // 2. ä¸–ç•Œä¿¡æ¯å­˜å‚¨ï¼ˆSQLite + å‘é‡æ•°æ®åº“ï¼‰
  final WorldInfoStorage worldInfoStorage;

  // 3. èŠå¤©è®°å½•å­˜å‚¨ï¼ˆSQLite + å‹ç¼©ï¼‰
  final ChatStorage chatStorage;

  // 4. åª’ä½“æ–‡ä»¶å­˜å‚¨ï¼ˆæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼‰
  final MediaStorage mediaStorage;

  // 5. äº‘åŒæ­¥å­˜å‚¨ï¼ˆå¯é€‰ï¼‰
  final CloudStorage? cloudStorage;
}
```

---

> ğŸ’¡ **å®æ–½å»ºè®®**: é…’é¦†å¯¹è¯åŠŸèƒ½æ˜¯ä¸€ä¸ªå¤æ‚çš„ç³»ç»Ÿï¼Œå»ºè®®åˆ†é˜¶æ®µå®æ–½ã€‚å…ˆå®ŒæˆåŸºç¡€çš„è§’è‰²ç³»ç»Ÿï¼Œç„¶åé€æ­¥æ·»åŠ ä¸–ç•Œä¿¡æ¯å’Œé«˜çº§åŠŸèƒ½ã€‚

> ï¿½ **é…’é¦†å¯¹è¯ä¼˜åŠ¿**:
> 1. **ç§»åŠ¨ç«¯åŸç”Ÿä½“éªŒ**: ä¸“ä¸ºç§»åŠ¨è®¾å¤‡ä¼˜åŒ–çš„è§’è‰²æ‰®æ¼”ç•Œé¢
> 2. **å®Œæ•´çš„ SillyTavern å…¼å®¹**: æ”¯æŒç°æœ‰çš„è§’è‰²å¡ç‰‡å’Œä¸–ç•Œä¿¡æ¯
> 3. **äº‘ç«¯åŒæ­¥**: è·¨è®¾å¤‡çš„è§’è‰²å’ŒèŠå¤©è®°å½•åŒæ­¥
> 4. **æ€§èƒ½ä¼˜åŒ–**: é’ˆå¯¹ç§»åŠ¨è®¾å¤‡çš„æ€§èƒ½ä¼˜åŒ–
> 5. **ä¸­æ–‡æœ¬åœ°åŒ–**: å®Œæ•´çš„ä¸­æ–‡ç•Œé¢å’Œæ–‡æ¡£æ”¯æŒ

> ğŸš€ **å¸‚åœºå®šä½**: YumCha å°†æˆä¸ºé¦–ä¸ªä¸“ä¸šçš„ç§»åŠ¨ç«¯é…’é¦†å¯¹è¯åº”ç”¨ï¼Œå¡«è¡¥ç§»åŠ¨ç«¯è§’è‰²æ‰®æ¼”èŠå¤©çš„å¸‚åœºç©ºç™½ï¼
