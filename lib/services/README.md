# ğŸ“ Services ç›®å½•è¯¦ç»†ä»‹ç»

Servicesç›®å½•æ˜¯æ•´ä¸ªåº”ç”¨çš„ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®å¤„ç†ä¸­å¿ƒï¼ŒåŒ…å«äº†æ‰€æœ‰æ ¸å¿ƒæœåŠ¡çš„å®ç°ã€‚

## ğŸ—ï¸ ç›®å½•ç»“æ„æ¦‚è§ˆ

```
lib/services/
â”œâ”€â”€ ai/                          # ğŸ¤– AIæœåŠ¡æ¨¡å—ï¼ˆé‡æ„åçš„æ–°æ¶æ„ï¼‰
â”‚   â”œâ”€â”€ ai_service_manager.dart  # AIæœåŠ¡ç®¡ç†å™¨ï¼ˆæ ¸å¿ƒå…¥å£ï¼‰
â”‚   â”œâ”€â”€ core/                    # æ ¸å¿ƒåŸºç¡€è®¾æ–½
â”‚   â”œâ”€â”€ chat/                    # èŠå¤©æœåŠ¡
â”‚   â”œâ”€â”€ capabilities/            # AIèƒ½åŠ›æœåŠ¡
â”‚   â””â”€â”€ providers/               # RiverpodçŠ¶æ€ç®¡ç†
â”œâ”€â”€ ai_dart_service.dart         # ğŸ”„ AI Dartåº“é€‚é…æœåŠ¡
â”œâ”€â”€ ai_request_service.dart      # ğŸ”„ æ—§ç‰ˆAIæœåŠ¡ï¼ˆå¾…åºŸå¼ƒï¼‰
â”œâ”€â”€ ai_service.dart              # ğŸ”„ æ—§ç‰ˆAIæœåŠ¡ï¼ˆå¾…åºŸå¼ƒï¼‰
â”œâ”€â”€ ai_service_new.dart          # ğŸ”„ æ–°ç‰ˆAIæœåŠ¡ï¼ˆå…¼å®¹å±‚ï¼‰
â”œâ”€â”€ database_service.dart        # ğŸ’¾ æ•°æ®åº“æœåŠ¡
â”œâ”€â”€ favorite_model_repository.dart # â­ æ”¶è—æ¨¡å‹æ•°æ®ä»“åº“
â”œâ”€â”€ logger_service.dart          # ğŸ“ æ—¥å¿—è®°å½•æœåŠ¡
â”œâ”€â”€ mcp_service.dart             # ğŸ”Œ MCPåè®®æœåŠ¡
â”œâ”€â”€ model_management_service.dart # ğŸ§  æ¨¡å‹ç®¡ç†æœåŠ¡
â”œâ”€â”€ notification_service.dart    # ğŸ“¢ é€šçŸ¥æœåŠ¡
â”œâ”€â”€ preference_service.dart      # âš™ï¸ ç”¨æˆ·åå¥½è®¾ç½®æœåŠ¡
â”œâ”€â”€ provider_config_service.dart # ğŸ“‹ æä¾›å•†é…ç½®æœåŠ¡
â”œâ”€â”€ provider_repository.dart     # ğŸ”Œ AIæä¾›å•†æ•°æ®ä»“åº“
â”œâ”€â”€ assistant_repository.dart    # ğŸ¤– AIåŠ©æ‰‹æ•°æ®ä»“åº“
â”œâ”€â”€ conversation_repository.dart # ğŸ’¬ å¯¹è¯æ•°æ®ä»“åº“
â”œâ”€â”€ message_repository.dart      # ğŸ“¨ æ¶ˆæ¯æ•°æ®ä»“åº“
â”œâ”€â”€ theme_service.dart           # ğŸ¨ ä¸»é¢˜ç®¡ç†æœåŠ¡
â””â”€â”€ validation_service.dart      # âœ… æ•°æ®éªŒè¯æœåŠ¡
```

## ğŸ¯ æ ¸å¿ƒæœåŠ¡åˆ†ç±»

### 1. ğŸ¤– AIæœåŠ¡å±‚ (ai/)
**æ–°æ¶æ„çš„AIåŠŸèƒ½å®ç°ï¼Œæ¨èä½¿ç”¨**

#### æ ¸å¿ƒç®¡ç†å™¨
- **`ai_service_manager.dart`** - AIæœåŠ¡çš„ç»Ÿä¸€ç®¡ç†å™¨
  - ğŸ¯ **ä½œç”¨**: ç»Ÿä¸€ç®¡ç†æ‰€æœ‰AIç›¸å…³æœåŠ¡
  - ğŸ”§ **åŠŸèƒ½**: æœåŠ¡æ³¨å†Œã€åˆå§‹åŒ–ã€å¥åº·æ£€æŸ¥ã€ç»Ÿè®¡ç›‘æ§
  - ğŸ‘¥ **ç”¨æˆ·**: åº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ–ï¼Œå…¶ä»–æœåŠ¡é€šè¿‡å®ƒè®¿é—®AIåŠŸèƒ½

#### åŸºç¡€è®¾æ–½ (core/)
- **`ai_service_base.dart`** - AIæœåŠ¡åŸºç±»å’Œèƒ½åŠ›å®šä¹‰
- **`ai_response_models.dart`** - AIå“åº”æ•°æ®æ¨¡å‹
- **`ai_provider_adapter.dart`** - AIæä¾›å•†é€‚é…å™¨

#### å…·ä½“æœåŠ¡ (chat/, capabilities/)
- **`chat_service.dart`** - èŠå¤©å¯¹è¯æœåŠ¡
- **`model_service.dart`** - æ¨¡å‹ç®¡ç†æœåŠ¡
- **`embedding_service.dart`** - å‘é‡åµŒå…¥æœåŠ¡
- **`speech_service.dart`** - è¯­éŸ³å¤„ç†æœåŠ¡

#### çŠ¶æ€ç®¡ç† (providers/)
- **`ai_service_provider.dart`** - RiverpodçŠ¶æ€ç®¡ç†æä¾›è€…

### 2. ğŸ’¾ æ•°æ®æŒä¹…åŒ–å±‚
**è´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œæ£€ç´¢**

#### æ•°æ®åº“æ ¸å¿ƒ
- **`database_service.dart`** - æ•°æ®åº“è¿æ¥å’Œç®¡ç†
  - ğŸ¯ **ä½œç”¨**: SQLiteæ•°æ®åº“çš„åˆå§‹åŒ–ã€è¿æ¥ç®¡ç†ã€è¿ç§»
  - ğŸ”§ **åŠŸèƒ½**: æ•°æ®åº“åˆ›å»ºã€è¡¨ç»“æ„ç®¡ç†ã€äº‹åŠ¡å¤„ç†
  - ğŸ‘¥ **ç”¨æˆ·**: æ‰€æœ‰Repositoryç±»çš„åº•å±‚ä¾èµ–

#### æ•°æ®ä»“åº“ (Repository Pattern)
- **`provider_repository.dart`** - AIæä¾›å•†æ•°æ®ç®¡ç†
  - ğŸ¯ **ä½œç”¨**: ç®¡ç†AIæä¾›å•†çš„CRUDæ“ä½œ
  - ğŸ”§ **åŠŸèƒ½**: æä¾›å•†çš„å¢åˆ æ”¹æŸ¥ã€é…ç½®ç®¡ç†
  
- **`assistant_repository.dart`** - AIåŠ©æ‰‹æ•°æ®ç®¡ç†
  - ğŸ¯ **ä½œç”¨**: ç®¡ç†AIåŠ©æ‰‹çš„é…ç½®å’Œå‚æ•°
  - ğŸ”§ **åŠŸèƒ½**: åŠ©æ‰‹çš„åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ã€æŸ¥è¯¢
  
- **`conversation_repository.dart`** - å¯¹è¯æ•°æ®ç®¡ç†
  - ğŸ¯ **ä½œç”¨**: ç®¡ç†èŠå¤©å¯¹è¯çš„å…ƒæ•°æ®
  - ğŸ”§ **åŠŸèƒ½**: å¯¹è¯çš„åˆ›å»ºã€åˆ—è¡¨ã€åˆ é™¤ã€æœç´¢
  
- **`message_repository.dart`** - æ¶ˆæ¯æ•°æ®ç®¡ç†
  - ğŸ¯ **ä½œç”¨**: ç®¡ç†å…·ä½“çš„èŠå¤©æ¶ˆæ¯
  - ğŸ”§ **åŠŸèƒ½**: æ¶ˆæ¯çš„å­˜å‚¨ã€æ£€ç´¢ã€åˆ†é¡µã€æœç´¢
  
- **`model_repository.dart`** - AIæ¨¡å‹æ•°æ®ç®¡ç†
  - ğŸ¯ **ä½œç”¨**: ç®¡ç†AIæ¨¡å‹çš„é…ç½®ä¿¡æ¯
  - ğŸ”§ **åŠŸèƒ½**: æ¨¡å‹çš„æ³¨å†Œã€æŸ¥è¯¢ã€èƒ½åŠ›ç®¡ç†

### 3. ğŸ› ï¸ åŸºç¡€è®¾æ–½æœåŠ¡
**æä¾›åº”ç”¨è¿è¡Œçš„åŸºç¡€æ”¯æŒ**

#### æ—¥å¿—ç³»ç»Ÿ
- **`logger_service.dart`** - ç»Ÿä¸€æ—¥å¿—è®°å½•æœåŠ¡
  - ğŸ¯ **ä½œç”¨**: æä¾›å…¨åº”ç”¨çš„æ—¥å¿—è®°å½•åŠŸèƒ½
  - ğŸ”§ **åŠŸèƒ½**: åˆ†çº§æ—¥å¿—ã€ç¾è§‚è¾“å‡ºã€AIä¸“ç”¨æ—¥å¿—ã€æ€§èƒ½ç›‘æ§
  - ğŸ‘¥ **ç”¨æˆ·**: æ‰€æœ‰å…¶ä»–æœåŠ¡éƒ½ä¾èµ–å®ƒè¿›è¡Œæ—¥å¿—è®°å½•

#### ä¸»é¢˜ç³»ç»Ÿ
- **`theme_service.dart`** - åº”ç”¨ä¸»é¢˜ç®¡ç†æœåŠ¡
  - ğŸ¯ **ä½œç”¨**: ç®¡ç†åº”ç”¨çš„ä¸»é¢˜å’Œå¤–è§‚è®¾ç½®
  - ğŸ”§ **åŠŸèƒ½**: ä¸»é¢˜åˆ‡æ¢ã€é¢œè‰²ç®¡ç†ã€ç”¨æˆ·åå¥½å­˜å‚¨
  - ğŸ‘¥ **ç”¨æˆ·**: UIå±‚é€šè¿‡å®ƒè·å–ä¸»é¢˜é…ç½®

### 4. ï¿½ æ‰©å±•æœåŠ¡å±‚
**æä¾›ä¸“é—¨åŠŸèƒ½å’Œæ‰©å±•èƒ½åŠ›çš„æœåŠ¡**

#### AI é€‚é…æœåŠ¡
- **`ai_dart_service.dart`** - AI Dartåº“é€‚é…æœåŠ¡
  - ğŸ¯ **ä½œç”¨**: æ–° ai_dart åº“ä¸ç°æœ‰æ¶æ„çš„é€‚é…å±‚
  - ğŸ”§ **åŠŸèƒ½**: æ¨¡å‹è½¬æ¢ã€æä¾›å•†é€‚é…ã€æ¨ç†æ”¯æŒã€å·¥å…·è°ƒç”¨
  - ğŸ‘¥ **ç”¨æˆ·**: æ›¿ä»£æ—§ç‰ˆAIæœåŠ¡ï¼Œæä¾›æ›´å¥½çš„åŠŸèƒ½æ”¯æŒ

#### æ¨¡å‹ç®¡ç†æœåŠ¡
- **`model_management_service.dart`** - æ¨¡å‹ç®¡ç†æœåŠ¡
  - ğŸ¯ **ä½œç”¨**: ä»æä¾›å•†APIåŠ¨æ€è·å–å’Œç®¡ç†æ¨¡å‹åˆ—è¡¨
  - ğŸ”§ **åŠŸèƒ½**: æ¨¡å‹è·å–ã€èƒ½åŠ›æ£€æµ‹ã€é”™è¯¯å¤„ç†ã€è®¤è¯éªŒè¯
  - ğŸ‘¥ **ç”¨æˆ·**: æä¾›å•†é…ç½®ç•Œé¢ã€æ¨¡å‹é€‰æ‹©åŠŸèƒ½

- **`favorite_model_repository.dart`** - æ”¶è—æ¨¡å‹æ•°æ®ä»“åº“
  - ğŸ¯ **ä½œç”¨**: ç®¡ç†ç”¨æˆ·æ”¶è—çš„AIæ¨¡å‹
  - ğŸ”§ **åŠŸèƒ½**: æ”¶è—ç®¡ç†ã€çŠ¶æ€æ£€æŸ¥ã€åˆ‡æ¢æ“ä½œã€åˆ†ç±»æŸ¥è¯¢
  - ğŸ‘¥ **ç”¨æˆ·**: æ¨¡å‹é€‰æ‹©ç•Œé¢ã€å¿«é€Ÿè®¿é—®åŠŸèƒ½

#### é€šçŸ¥å’Œåå¥½æœåŠ¡
- **`notification_service.dart`** - é€šçŸ¥æœåŠ¡
  - ğŸ¯ **ä½œç”¨**: ç»Ÿä¸€çš„ç”¨æˆ·é€šçŸ¥åŠŸèƒ½
  - ğŸ”§ **åŠŸèƒ½**: SnackBaré€šçŸ¥ã€ç¡®è®¤å¯¹è¯æ¡†ã€ä¸»é¢˜é€‚é…ã€è‡ªå®šä¹‰æ“ä½œ
  - ğŸ‘¥ **ç”¨æˆ·**: å…¨åº”ç”¨çš„ç”¨æˆ·åé¦ˆå’Œé€šçŸ¥æ˜¾ç¤º

- **`preference_service.dart`** - ç”¨æˆ·åå¥½è®¾ç½®æœåŠ¡
  - ğŸ¯ **ä½œç”¨**: ç®¡ç†ç”¨æˆ·åå¥½è®¾ç½®å’Œåº”ç”¨çŠ¶æ€æŒä¹…åŒ–
  - ğŸ”§ **åŠŸèƒ½**: æ¨¡å‹åå¥½ã€åŠ©æ‰‹åå¥½ã€ç•Œé¢åå¥½ã€è°ƒè¯•è®¾ç½®
  - ğŸ‘¥ **ç”¨æˆ·**: åº”ç”¨å¯åŠ¨æ¢å¤ã€ä¸ªæ€§åŒ–ä½“éªŒ

#### é…ç½®å’ŒéªŒè¯æœåŠ¡
- **`provider_config_service.dart`** - æä¾›å•†é…ç½®æœåŠ¡
  - ğŸ¯ **ä½œç”¨**: æä¾›çŸ¥åAIæä¾›å•†çš„æ ‡å‡†é…ç½®ä¿¡æ¯
  - ğŸ”§ **åŠŸèƒ½**: æ ‡å‡†é…ç½®ã€èƒ½åŠ›è¯†åˆ«ã€å®šä»·ä¿¡æ¯ã€æ¨¡å‹ç­›é€‰
  - ğŸ‘¥ **ç”¨æˆ·**: æ¨¡å‹èƒ½åŠ›æ£€æµ‹ã€é…ç½®å»ºè®®ã€ä¿¡æ¯å±•ç¤º

- **`validation_service.dart`** - æ•°æ®éªŒè¯æœåŠ¡
  - ğŸ¯ **ä½œç”¨**: ç»Ÿä¸€çš„æ•°æ®éªŒè¯åŠŸèƒ½
  - ğŸ”§ **åŠŸèƒ½**: æä¾›å•†éªŒè¯ã€åŠ©æ‰‹éªŒè¯ã€æ¶ˆæ¯éªŒè¯ã€å‚æ•°éªŒè¯
  - ğŸ‘¥ **ç”¨æˆ·**: ç”¨æˆ·è¾“å…¥éªŒè¯ã€é…ç½®æ£€æŸ¥ã€ç³»ç»Ÿå¥åº·æ£€æŸ¥

#### MCP åè®®æœåŠ¡
- **`mcp_service.dart`** - MCPåè®®æœåŠ¡
  - ğŸ¯ **ä½œç”¨**: ç®¡ç†MCPæœåŠ¡å™¨è¿æ¥å’Œå·¥å…·è°ƒç”¨
  - ğŸ”§ **åŠŸèƒ½**: æœåŠ¡å™¨ç®¡ç†ã€å·¥å…·è°ƒç”¨ã€å¤šåè®®æ”¯æŒã€å¹³å°é€‚é…
  - ğŸ‘¥ **ç”¨æˆ·**: AIå·¥å…·æ‰©å±•ã€å¤–éƒ¨æœåŠ¡é›†æˆ

### 5. ğŸ”„ é—ç•™æœåŠ¡ (å¾…åºŸå¼ƒ)
**é‡æ„å‰çš„æ—§ç‰ˆAIæœåŠ¡ï¼Œé€æ­¥è¿ç§»ä¸­**

- **`ai_request_service.dart`** - æ—§ç‰ˆAIè¯·æ±‚æœåŠ¡
- **`ai_service.dart`** - æ—§ç‰ˆAIæœåŠ¡ä¸»ç±»
- **`ai_service_new.dart`** - æ–°ç‰ˆAIæœåŠ¡å…¼å®¹å±‚

## ğŸ“‹ è¯¦ç»†æœåŠ¡ä»‹ç»

### ğŸ¤– AIæœåŠ¡å±‚è¯¦è§£

#### `ai_service_manager.dart` - AIæœåŠ¡ç®¡ç†å™¨
**ä½œç”¨**: ç»Ÿä¸€ç®¡ç†æ‰€æœ‰AIç›¸å…³æœåŠ¡çš„æ ¸å¿ƒå…¥å£
- ğŸ¯ **æœåŠ¡æ³¨å†Œ**: æ³¨å†ŒChatServiceã€ModelServiceç­‰å­æœåŠ¡
- ğŸ”„ **ç”Ÿå‘½å‘¨æœŸ**: ç®¡ç†æœåŠ¡çš„åˆå§‹åŒ–ã€å¥åº·æ£€æŸ¥ã€èµ„æºæ¸…ç†
- ğŸ“Š **ç»Ÿè®¡ç›‘æ§**: æ”¶é›†AIæœåŠ¡çš„ä½¿ç”¨ç»Ÿè®¡å’Œæ€§èƒ½æ•°æ®
- ğŸ›ï¸ **ç»Ÿä¸€æ¥å£**: ä¸ºä¸Šå±‚æä¾›ç®€åŒ–çš„AIåŠŸèƒ½è®¿é—®æ¥å£

**ä½¿ç”¨åœºæ™¯**: åº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ–ï¼Œå…¶ä»–æ¨¡å—é€šè¿‡å®ƒè®¿é—®AIåŠŸèƒ½

#### `chat_service.dart` - èŠå¤©æœåŠ¡
**ä½œç”¨**: å¤„ç†AIå¯¹è¯çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- ğŸ’¬ **å•æ¬¡èŠå¤©**: å‘é€æ¶ˆæ¯å¹¶ç­‰å¾…å®Œæ•´å“åº”
- âš¡ **æµå¼èŠå¤©**: å®æ—¶æ¥æ”¶AIå“åº”æµ
- ğŸ”§ **å·¥å…·è°ƒç”¨**: æ”¯æŒAIè°ƒç”¨å¤–éƒ¨å·¥å…·å’Œå‡½æ•°
- ğŸ§  **æ¨ç†æ€è€ƒ**: æ˜¾ç¤ºAIçš„æ€è€ƒè¿‡ç¨‹ï¼ˆå¦‚o1æ¨¡å‹ï¼‰
- ğŸ‘ï¸ **è§†è§‰ç†è§£**: å¤„ç†åŒ…å«å›¾åƒçš„å¤šæ¨¡æ€å¯¹è¯

**ä½¿ç”¨åœºæ™¯**: èŠå¤©ç•Œé¢ã€AIåŠ©æ‰‹å¯¹è¯ã€å†…å®¹ç”Ÿæˆ

#### `model_service.dart` - æ¨¡å‹ç®¡ç†æœåŠ¡
**ä½œç”¨**: ç®¡ç†AIæ¨¡å‹çš„ä¿¡æ¯å’Œèƒ½åŠ›
- ğŸ“‹ **æ¨¡å‹åˆ—è¡¨**: ä»æä¾›å•†è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨
- ğŸ·ï¸ **èƒ½åŠ›æ£€æµ‹**: æ£€æµ‹æ¨¡å‹æ”¯æŒçš„AIèƒ½åŠ›ï¼ˆè§†è§‰ã€å·¥å…·ç­‰ï¼‰
- ğŸ’¾ **æ™ºèƒ½ç¼“å­˜**: ç¼“å­˜æ¨¡å‹ä¿¡æ¯ä»¥æå‡æ€§èƒ½
- ğŸ”„ **è‡ªåŠ¨åˆ·æ–°**: å®šæœŸæ›´æ–°æ¨¡å‹åˆ—è¡¨

**ä½¿ç”¨åœºæ™¯**: æ¨¡å‹é€‰æ‹©ç•Œé¢ã€èƒ½åŠ›æ£€æµ‹ã€é…ç½®éªŒè¯

### ğŸ’¾ æ•°æ®æŒä¹…åŒ–å±‚è¯¦è§£

#### `database_service.dart` - æ•°æ®åº“æœåŠ¡
**ä½œç”¨**: åº”ç”¨æ•°æ®å­˜å‚¨çš„ç»Ÿä¸€è®¿é—®å…¥å£
- ğŸ—ï¸ **è¿æ¥ç®¡ç†**: ç®¡ç†SQLiteæ•°æ®åº“è¿æ¥
- ğŸ”„ **å®ä¾‹æ§åˆ¶**: ç¡®ä¿å…¨åº”ç”¨ä½¿ç”¨åŒä¸€æ•°æ®åº“å®ä¾‹
- ğŸ’¾ **èµ„æºç®¡ç†**: è´Ÿè´£æ•°æ®åº“èµ„æºçš„æ­£ç¡®é‡Šæ”¾

**æŠ€æœ¯æ ˆ**: Drift ORM + SQLite
**æ•°æ®åº“æ–‡ä»¶**: `yumcha.db`
**å½“å‰ç‰ˆæœ¬**: 2

#### Repositoryå±‚ - æ•°æ®è®¿é—®å¯¹è±¡
**è®¾è®¡æ¨¡å¼**: Repository Pattern
**ä½œç”¨**: ä¸ºä¸åŒä¸šåŠ¡å®ä½“æä¾›ç»Ÿä¸€çš„æ•°æ®è®¿é—®æ¥å£

##### `provider_repository.dart` - AIæä¾›å•†ä»“åº“
- ğŸ”Œ **æä¾›å•†ç®¡ç†**: OpenAIã€Anthropicã€Googleç­‰æä¾›å•†çš„CRUD
- âœ… **æ•°æ®éªŒè¯**: ç¡®ä¿æä¾›å•†é…ç½®çš„å®Œæ•´æ€§
- ğŸ›ï¸ **çŠ¶æ€ç®¡ç†**: å¯ç”¨/ç¦ç”¨æä¾›å•†
- ğŸ“ **æ“ä½œæ—¥å¿—**: è®°å½•æ‰€æœ‰æ•°æ®æ“ä½œ

##### `assistant_repository.dart` - AIåŠ©æ‰‹ä»“åº“
- ğŸ¤– **åŠ©æ‰‹é…ç½®**: ç®¡ç†AIåŠ©æ‰‹çš„ç³»ç»Ÿæç¤ºå’Œå‚æ•°
- ğŸ¨ **ä¸ªæ€§åŒ–**: æ”¯æŒè‡ªå®šä¹‰åŠ©æ‰‹å¤´åƒå’Œæè¿°
- âš™ï¸ **AIå‚æ•°**: æ¸©åº¦ã€top-pã€æœ€å¤§tokenç­‰å‚æ•°ç®¡ç†
- ğŸ”§ **åŠŸèƒ½å¼€å…³**: å·¥å…·è°ƒç”¨ã€è§†è§‰ç†è§£ç­‰èƒ½åŠ›å¼€å…³

##### `conversation_repository.dart` - å¯¹è¯ä»“åº“
- ğŸ’¬ **å¯¹è¯ç®¡ç†**: èŠå¤©å¯¹è¯çš„å…ƒæ•°æ®ç®¡ç†
- ğŸ“Š **åˆ†é¡µæŸ¥è¯¢**: æ”¯æŒå¤§é‡å¯¹è¯çš„åˆ†é¡µåŠ è½½
- ğŸ” **æœç´¢åŠŸèƒ½**: æŒ‰æ ‡é¢˜æœç´¢å¯¹è¯
- ğŸ“ˆ **ç»Ÿè®¡ä¿¡æ¯**: å¯¹è¯æ•°é‡ç»Ÿè®¡

##### `message_repository.dart` - æ¶ˆæ¯ä»“åº“
- ğŸ“¨ **æ¶ˆæ¯å­˜å‚¨**: èŠå¤©æ¶ˆæ¯çš„è¯¦ç»†å†…å®¹å­˜å‚¨
- ğŸ” **å…¨æ–‡æœç´¢**: æ”¯æŒæ¶ˆæ¯å†…å®¹çš„å…¨æ–‡æœç´¢
- ğŸ“„ **åˆ†é¡µåŠ è½½**: é«˜æ•ˆçš„æ¶ˆæ¯åˆ†é¡µåŠ è½½
- ğŸ–¼ï¸ **å¤šåª’ä½“**: æ”¯æŒå›¾åƒå’Œé™„ä»¶æ¶ˆæ¯

### ğŸ› ï¸ åŸºç¡€è®¾æ–½æœåŠ¡è¯¦è§£

#### `logger_service.dart` - æ—¥å¿—æœåŠ¡
**ä½œç”¨**: ç»Ÿä¸€çš„åº”ç”¨æ—¥å¿—è®°å½•ç³»ç»Ÿ
- ğŸ“ **åˆ†çº§æ—¥å¿—**: Debugã€Infoã€Warningã€Errorã€Fataläº”ä¸ªçº§åˆ«
- ğŸ¨ **ç¾è§‚è¾“å‡º**: å½©è‰²ã€ç»“æ„åŒ–çš„æ§åˆ¶å°è¾“å‡º
- ğŸ”§ **ç¯å¢ƒé€‚é…**: å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒçš„ä¸åŒç­–ç•¥
- ğŸ¤– **AIä¸“ç”¨**: é’ˆå¯¹AIåŠŸèƒ½çš„ä¸“é—¨æ—¥å¿—æ–¹æ³•

**ç‰¹æ€§**:
- å•ä¾‹æ¨¡å¼ç¡®ä¿å…¨å±€ä¸€è‡´
- è‡ªåŠ¨è°ƒç”¨æ ˆè·Ÿè¸ª
- æ€§èƒ½ä¼˜åŒ–çš„è¾“å‡ºè¿‡æ»¤
- æ”¯æŒé™„åŠ æ•°æ®è®°å½•

#### `theme_service.dart` - ä¸»é¢˜æœåŠ¡
**ä½œç”¨**: åº”ç”¨å¤–è§‚å’Œä¸»é¢˜çš„ç®¡ç†ä¸­å¿ƒ
- ğŸ¨ **å¤šä¸»é¢˜**: æ ‡å‡†ã€ä¸­å¯¹æ¯”ã€é«˜å¯¹æ¯”ã€æ´»åŠ›å››ç§ä¸»é¢˜
- ğŸŒ“ **æ˜æš—æ¨¡å¼**: æµ…è‰²ã€æ·±è‰²ã€è·Ÿéšç³»ç»Ÿä¸‰ç§æ¨¡å¼
- ğŸ¯ **åŠ¨æ€é¢œè‰²**: Android 12+ Material YouåŠ¨æ€é¢œè‰²æ”¯æŒ
- â™¿ **å¯è®¿é—®æ€§**: é«˜å¯¹æ¯”åº¦ä¸»é¢˜æ”¯æŒè§†è§‰éšœç¢ç”¨æˆ·
- ğŸ’¾ **æŒä¹…åŒ–**: ç”¨æˆ·åå¥½è‡ªåŠ¨ä¿å­˜å’Œæ¢å¤

**æŠ€æœ¯ç‰¹æ€§**:
- ChangeNotifierå®ç°å“åº”å¼æ›´æ–°
- SharedPreferencesæŒä¹…åŒ–å­˜å‚¨
- åŠ¨æ€é¢œè‰²è‡ªåŠ¨æ£€æµ‹å’Œé™çº§
- å®æ—¶ä¸»é¢˜åˆ‡æ¢æ— éœ€é‡å¯

### ğŸ”§ æ‰©å±•æœåŠ¡å±‚è¯¦è§£

#### `ai_dart_service.dart` - AI Dartåº“é€‚é…æœåŠ¡
**ä½œç”¨**: æ–° ai_dart åº“ä¸ç°æœ‰æœåŠ¡æ¶æ„çš„é€‚é…å±‚

- ğŸ”„ **æ¨¡å‹è½¬æ¢**: å°†åº”ç”¨æ¨¡å‹è½¬æ¢ä¸º ai_dart åº“æ¨¡å‹
- ğŸ¤– **æä¾›å•†é€‚é…**: æ”¯æŒ OpenAIã€Anthropicã€Google ç­‰å¤šç§æä¾›å•†
- ğŸ’¬ **èŠå¤©åŠŸèƒ½**: æä¾›å•æ¬¡å’Œæµå¼èŠå¤©æ¥å£
- ğŸ§  **æ¨ç†æ”¯æŒ**: æ”¯æŒ AI æ¨ç†æ€è€ƒè¿‡ç¨‹æ˜¾ç¤ºï¼ˆå¦‚ o1 æ¨¡å‹ï¼‰
- ğŸ”§ **å·¥å…·è°ƒç”¨**: æ”¯æŒ AI å·¥å…·å’Œå‡½æ•°è°ƒç”¨
- ğŸ§ª **è¿æ¥æµ‹è¯•**: æä¾›æä¾›å•†è¿æ¥æµ‹è¯•åŠŸèƒ½

**æŠ€æœ¯ç‰¹æ€§**:
- å•ä¾‹æ¨¡å¼ç¡®ä¿å…¨å±€ä¸€è‡´
- è¯¦ç»†çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- æ”¯æŒæœ€æ–°çš„ AI åŠŸèƒ½ç‰¹æ€§
- è‡ªåŠ¨é€‚é…ä¸åŒæä¾›å•†çš„ API å·®å¼‚

#### `model_management_service.dart` - æ¨¡å‹ç®¡ç†æœåŠ¡
**ä½œç”¨**: ä» AI æä¾›å•†åŠ¨æ€è·å–å’Œç®¡ç†æ¨¡å‹åˆ—è¡¨

- ğŸ“‹ **åŠ¨æ€è·å–**: ä»æä¾›å•† API å®æ—¶è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨
- ğŸ” **èƒ½åŠ›æ£€æµ‹**: æ£€æµ‹æä¾›å•†æ˜¯å¦æ”¯æŒæ¨¡å‹åˆ—è¡¨ API
- ğŸ›¡ï¸ **é”™è¯¯å¤„ç†**: æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œå¤„ç†å»ºè®®
- ğŸ”‘ **è®¤è¯éªŒè¯**: éªŒè¯ API å¯†é’¥çš„æœ‰æ•ˆæ€§
- ğŸŒ **ç½‘ç»œæ£€æµ‹**: æ£€æµ‹ç½‘ç»œè¿æ¥å’Œ Base URL é…ç½®

**è®¾è®¡ç†å¿µ**:
- ä¸æä¾›ç¡¬ç¼–ç çš„å›é€€æ¨¡å‹åˆ—è¡¨
- é¼“åŠ±ç”¨æˆ·æ‰‹åŠ¨æ·»åŠ æ¨¡å‹ä»¥ç¡®ä¿å‡†ç¡®æ€§
- æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯æŒ‡å¯¼ç”¨æˆ·è§£å†³é—®é¢˜

#### `notification_service.dart` - é€šçŸ¥æœåŠ¡
**ä½œç”¨**: ç»Ÿä¸€çš„ç”¨æˆ·é€šçŸ¥åŠŸèƒ½

- ğŸ“¢ **SnackBar é€šçŸ¥**: åº•éƒ¨æµ®åŠ¨é€šçŸ¥ï¼Œæ”¯æŒè‡ªåŠ¨å…³é—­
- ğŸ¨ **ä¸»é¢˜é€‚é…**: è‡ªåŠ¨é€‚é… Material 3 ä¸»é¢˜é¢œè‰²
- ğŸ”” **å¤šç§ç±»å‹**: æˆåŠŸã€é”™è¯¯ã€è­¦å‘Šã€ä¿¡æ¯å››ç§é€šçŸ¥ç±»å‹
- ğŸ’¬ **ç¡®è®¤å¯¹è¯æ¡†**: æ”¯æŒç”¨æˆ·ç¡®è®¤æ“ä½œçš„å¯¹è¯æ¡†
- ğŸ“‹ **åº•éƒ¨é€šçŸ¥å¡ç‰‡**: æ›´ä¸°å¯Œçš„é€šçŸ¥å±•ç¤ºæ–¹å¼
- âš™ï¸ **è‡ªå®šä¹‰æ“ä½œ**: æ”¯æŒè‡ªå®šä¹‰æ“ä½œæŒ‰é’®å’Œå›è°ƒ

**è®¾è®¡ç‰¹ç‚¹**:
- ä½¿ç”¨ Material 3 è®¾è®¡è§„èŒƒ
- æ”¯æŒåŠ¨æ€é¢œè‰²å’Œä¸»é¢˜åˆ‡æ¢
- æä¾›ä¸€è‡´çš„ç”¨æˆ·ä½“éªŒ

#### `mcp_service.dart` - MCPåè®®æœåŠ¡
**ä½œç”¨**: ç®¡ç† MCP æœåŠ¡å™¨è¿æ¥å’Œå·¥å…·è°ƒç”¨åŠŸèƒ½

- ğŸ”Œ **æœåŠ¡å™¨ç®¡ç†**: è¿æ¥å’Œç®¡ç†å¤šä¸ª MCP æœåŠ¡å™¨
- ğŸ› ï¸ **å·¥å…·è°ƒç”¨**: è°ƒç”¨ MCP æœåŠ¡å™¨æä¾›çš„å·¥å…·
- ğŸŒ **å¤šåè®®æ”¯æŒ**: æ”¯æŒ STDIOã€HTTPã€SSE è¿æ¥ç±»å‹
- ğŸ“± **å¹³å°é€‚é…**: æ ¹æ®å¹³å°èƒ½åŠ›è‡ªåŠ¨é€‚é…è¿æ¥æ–¹å¼
- ğŸ” **çŠ¶æ€ç›‘æ§**: å®æ—¶ç›‘æ§æœåŠ¡å™¨è¿æ¥çŠ¶æ€
- âš™ï¸ **é…ç½®éªŒè¯**: éªŒè¯æœåŠ¡å™¨é…ç½®çš„æœ‰æ•ˆæ€§

**æ”¯æŒçš„è¿æ¥ç±»å‹**:
- **STDIO**: æœ¬åœ°è¿›ç¨‹é€šä¿¡ï¼ˆæ¡Œé¢å¹³å°ï¼‰
- **HTTP**: HTTP API è¿æ¥ï¼ˆæ‰€æœ‰å¹³å°ï¼‰
- **SSE**: æœåŠ¡å™¨å‘é€äº‹ä»¶ï¼ˆæ‰€æœ‰å¹³å°ï¼‰

## ğŸ”„ æœåŠ¡ä¾èµ–å…³ç³»

```mermaid
graph TD
    A[AI Service Manager] --> B[Chat Service]
    A --> C[Model Service]
    A --> D[Embedding Service]
    A --> E[Speech Service]

    B --> F[Logger Service]
    C --> F
    D --> F
    E --> F

    G[Provider Repository] --> H[Database Service]
    I[Assistant Repository] --> H
    J[Conversation Repository] --> H
    K[Message Repository] --> H
    L[Model Repository] --> H

    H --> F
    M[Theme Service] --> F
    N[Validation Service] --> F
```

## ğŸš€ ä½¿ç”¨æŒ‡å—

### ğŸ¯ æ–°ç”¨æˆ·æ¨èè·¯å¾„

#### 1. AIåŠŸèƒ½å¼€å‘
```dart
// ä½¿ç”¨æ–°çš„AIæœåŠ¡æ¶æ„
final manager = ref.read(aiServiceManagerProvider);
await ref.read(initializeAiServicesProvider.future);

// å‘é€èŠå¤©æ¶ˆæ¯
final response = await ref.read(smartChatProvider(
  SmartChatParams(
    chatHistory: messages,
    userMessage: userInput,
  ),
).future);
```

#### 2. æ•°æ®æ“ä½œ
```dart
// ä½¿ç”¨Repositoryè¿›è¡Œæ•°æ®æ“ä½œ
final dbService = DatabaseService.instance;
final providerRepo = ProviderRepository(dbService.database);

// è·å–æ‰€æœ‰æä¾›å•†
final providers = await providerRepo.getAllProviders();
```

#### 3. æ—¥å¿—è®°å½•
```dart
// ä½¿ç”¨LoggerServiceè¿›è¡Œè°ƒè¯•
final logger = LoggerService();
logger.info('æ“ä½œæˆåŠŸ');
logger.error('å‘ç”Ÿé”™è¯¯', error, stackTrace);
```

#### 4. ä¸»é¢˜ç®¡ç†
```dart
// ä½¿ç”¨ThemeServiceç®¡ç†å¤–è§‚
final themeService = ThemeService();
await themeService.setColorMode(ColorMode.dark);
await themeService.setAppThemeType(AppThemeType.vibrant);
```

### âš ï¸ å¼€å‘è€…æ³¨æ„äº‹é¡¹

#### âœ… æ¨èåšæ³•
- **ä½¿ç”¨æ–°æ¶æ„**: ä¼˜å…ˆä½¿ç”¨ `ai/` ç›®å½•ä¸‹çš„æ–°AIæœåŠ¡
- **Repositoryæ¨¡å¼**: é€šè¿‡Repositoryç±»è¿›è¡Œæ•°æ®æ“ä½œ
- **ç»Ÿä¸€æ—¥å¿—**: æ‰€æœ‰æœåŠ¡éƒ½ä½¿ç”¨ `LoggerService`
- **å“åº”å¼ä¸»é¢˜**: ä½¿ç”¨ `ThemeService` çš„ChangeNotifierç‰¹æ€§

#### âŒ é¿å…åšæ³•
- **ç›´æ¥æ•°æ®åº“è®¿é—®**: é¿å…ç»•è¿‡Repositoryç›´æ¥æ“ä½œæ•°æ®åº“
- **æ—§ç‰ˆAIæœåŠ¡**: é¿å…ä½¿ç”¨ `ai_service.dart` ç­‰æ—§ç‰ˆæ–‡ä»¶
- **ç¡¬ç¼–ç ä¸»é¢˜**: é¿å…åœ¨UIä¸­ç¡¬ç¼–ç é¢œè‰²å’Œä¸»é¢˜

#### ğŸ”„ è¿ç§»ç­–ç•¥
1. **é€æ­¥è¿ç§»**: å°†æ—§ä»£ç é€æ­¥è¿ç§»åˆ°æ–°æ¶æ„
2. **æµ‹è¯•è¦†ç›–**: ç¡®ä¿è¿ç§»è¿‡ç¨‹ä¸­çš„åŠŸèƒ½å®Œæ•´æ€§
3. **æ€§èƒ½ç›‘æ§**: å…³æ³¨è¿ç§»åçš„æ€§èƒ½è¡¨ç°
4. **ç”¨æˆ·ä½“éªŒ**: ä¿è¯è¿ç§»è¿‡ç¨‹ä¸­ç”¨æˆ·ä½“éªŒçš„è¿ç»­æ€§

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### æ•°æ®åº“ä¼˜åŒ–
- ä½¿ç”¨Repositoryçš„ç¼“å­˜æœºåˆ¶
- åˆç†ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢
- é¿å…é¢‘ç¹çš„æ•°æ®åº“è¿æ¥

### AIæœåŠ¡ä¼˜åŒ–
- å¤ç”¨AiServiceManagerå®ä¾‹
- ä½¿ç”¨æµå¼å“åº”æå‡ç”¨æˆ·ä½“éªŒ
- åˆç†é…ç½®æ¨¡å‹å‚æ•°

### ä¸»é¢˜æœåŠ¡ä¼˜åŒ–
- ç›‘å¬ä¸»é¢˜å˜åŒ–è€Œéè½®è¯¢
- ç¼“å­˜é¢œè‰²æ–¹æ¡ˆé¿å…é‡å¤è®¡ç®—
- ä½¿ç”¨åŠ¨æ€é¢œè‰²æ—¶æ³¨æ„å…¼å®¹æ€§
